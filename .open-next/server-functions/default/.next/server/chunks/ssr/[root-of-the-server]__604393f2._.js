module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},262212,a=>{a.n(a.i(866114))},636685,a=>{a.n(a.i(88402))},561923,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/point/advertiser/PointsDisplay.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/point/advertiser/PointsDisplay.tsx <module evaluation>","default")},935512,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/point/advertiser/PointsDisplay.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/point/advertiser/PointsDisplay.tsx","default")},17422,a=>{"use strict";a.i(561923);var b=a.i(935512);a.n(b)},545596,a=>{"use strict";a.s(["checkPaymentStatsDataAvailability",()=>n,"checkPendingPayments",()=>k,"getPaymentHistory",()=>l,"getPaymentStatsData",()=>m]);var b=a.i(137936),c=a.i(559330),d=a.i(446129),e=a.i(905246),f=a.i(713095);let g=Number("6"),h=process.env.NOWPAYMENTS_ENDPOINT,i=process.env.NOWPAYMENTS_SECRET_KEY,j=a=>({id:a.id,orderId:a.orderId,provider:a.provider,paymentMethod:a.paymentMethod,transactionId:a.transactionId,totalAmount:a.totalAmount.toString(),currency:a.currency,status:a.status,createdAt:a.createdAt}),k=async({advertiserId:a})=>{try{let b,f=await (0,e.cookies)(),g=f.get("accessToken")?.value;if(!g)return{success:!1,errMsg:"Unauthorized.",statusCode:401,pendingPayments:[],completedPayments:[]};let{result:j,data:k,message:l}=await (0,d.security)({jwtEncodedStr:g,readOnly:!0});if(!j||!k)return{success:!1,statusCode:401,errMsg:l,pendingPayments:[],completedPayments:[]};if(k.id!==a)return{success:!1,statusCode:401,errMsg:"Unauthorized.",pendingPayments:[],completedPayments:[]};let m=await c.default.payment.findMany({where:{userId:a,status:"pending"},select:{id:!0,orderId:!0,paymentMethod:!0,totalAmount:!0,metadata:!0,currency:!0,createdAt:!0,expiredAt:!0,provider:!0,transactionId:!0,purchaseAmount:!0,userId:!0},orderBy:{createdAt:"desc"}});if(0===m.length)return{success:!0,statusCode:200,errMsg:"",pendingPayments:[],completedPayments:[]};let n=[],o=!1;for(let a of m)try{let b="pending",e=a.expiredAt&&new Date>a.expiredAt;if("nowpayments"===a.provider&&a.transactionId)try{let c=await fetch(`${h}/payment/${a.transactionId}`,{method:"GET",headers:{"x-api-key":i}});if(c.ok)switch((await c.json()).payment_status){case"finished":case"confirmed":b="completed";break;case"failed":case"refunded":b="failed";break;case"expired":b="expired";break;default:b="pending"}else e&&(b="expired")}catch(c){console.error(`NOWPayments API call failed for payment ${a.id}:`,c),e&&(b="expired")}else e&&(b="expired");"pending"!==b&&await c.default.$transaction(async c=>{let e=null,f=null,g=await c.payment.update({where:{id:a.id},data:{status:b}});if("completed"===b){let b=`payment-${a.id}`;if(!await c.point.findUnique({where:{uniqueKey:b}})){let g=await c.point.create({data:{userId:a.userId,type:"purchase",amount:a.purchaseAmount,description:`仮想通貨決済によるポイント購入 (${a.paymentMethod?.toUpperCase()}) - 自動確認`,uniqueKey:b,paymentId:a.id}}),{amount:h}=await c.user.update({where:{id:a.userId},data:{amount:{increment:a.purchaseAmount}}}),{result:i,message:j}=await (0,d.saveAccessTokenInCookies)({id:k.id,name:k.name,userType:"advertiser",amount:Number(h)});if(!i)throw Error(j);e=g.id,f=a.purchaseAmount.toString(),o=!0}}n.push({id:g.id,orderId:g.orderId,paymentMethod:a.paymentMethod,totalAmount:a.totalAmount.toString(),currency:a.currency,status:b,completedAt:new Date,pointId:e,pointAmount:f})})}catch(b){console.error(`Error processing payment ${a.id}:`,b)}let p=m.filter(a=>!n.some(b=>b.id===a.id)).map(a=>({id:a.id,orderId:a.orderId,paymentMethod:a.paymentMethod,totalAmount:a.totalAmount.toString(),currency:a.currency,createdAt:a.createdAt,expiredAt:a.expiredAt,provider:a.provider}));if(o){let d=await c.default.user.findUnique({where:{id:a},select:{amount:!0}});d&&(b=d.amount.toString())}return{success:!0,statusCode:200,errMsg:"",pendingPayments:p,completedPayments:n,newBalance:b}}catch(a){return console.error("checkPendingPayments error:",a),{success:!1,statusCode:500,errMsg:a instanceof Error?a.message:"Internal Server Error.",pendingPayments:[],completedPayments:[]}}},l=async({advertiserId:a,page:b})=>{try{let f=await (0,e.cookies)(),h=f.get("accessToken")?.value;if(!h)return{success:!1,errMsg:"Unauthorized.",statusCode:401};let{result:i,data:k,message:l}=await (0,d.security)({jwtEncodedStr:h,readOnly:!0});if(!i||!k)return{success:!1,statusCode:401,errMsg:l};if(0===a){if("admin"!==k.userType)return{success:!1,statusCode:401,errMsg:"Admin access required."}}else if(k.id!==a)return{success:!1,statusCode:401,errMsg:"Unauthorized."};if(!b||b<1)return{success:!1,statusCode:400,errMsg:"Invalid page number."};let m=await c.default.payment.findMany({where:{...0!==a?{advertiserId:a}:{},status:"pending"},select:{id:!0,orderId:!0,provider:!0,paymentMethod:!0,transactionId:!0,totalAmount:!0,currency:!0,status:!0,createdAt:!0,metadata:!0,...0===a?{user:{select:{id:!0,name:!0}}}:{}},orderBy:{createdAt:"desc"}}),n=await c.default.payment.findMany({where:{...0!==a?{advertiserId:a}:{},status:{not:"pending"}},select:{id:!0,orderId:!0,provider:!0,paymentMethod:!0,transactionId:!0,totalAmount:!0,currency:!0,status:!0,createdAt:!0,metadata:!0,...0===a?{user:{select:{id:!0,name:!0}}}:{}},orderBy:{createdAt:"desc"},take:g+1,skip:(b-1)*g}),o=m.map(b=>({...j(b),...0===a&&b.user?{userName:b.user.name,advertiserIdInfo:b.user.id}:{}})),p=n.map(b=>({...j(b),...0===a&&b.user?{userName:b.user.name,advertiserIdInfo:b.user.id}:{}}));return{success:!0,statusCode:200,errMsg:"",data:p,pendingData:o}}catch(a){return console.error("getPaymentHistory error:",a),{success:!1,statusCode:500,errMsg:a instanceof Error?a.message:"Internal Server Error."}}};async function m({startDate:a}){try{let b,d;if(a){let[c,e]=a.split("-");if(b=Number(c),d=Number(e)-1,isNaN(b)||isNaN(d)||d<0||d>11)return{success:!1,data:null,errMsg:"Invalid date format. Use YYYY-MM-01.",statusCode:400}}else{let a=new Date;b=a.getFullYear(),d=a.getMonth()}let e=new Date(b,d,1,0,0,0,0),f=new Date(b,d+1,0,23,59,59,999),g=await c.default.payment.findMany({where:{status:"completed",createdAt:{gte:e,lte:f}},select:{createdAt:!0,purchaseAmount:!0,totalAmount:!0},orderBy:{createdAt:"asc"}}),h=new Map;g.forEach(a=>{let b=a.createdAt.getFullYear()+"-"+String(a.createdAt.getMonth()+1).padStart(2,"0")+"-"+String(a.createdAt.getDate()).padStart(2,"0"),c=h.get(b)||{paymentCount:0,totalAmount:0,totalFees:0},d=Number(a.purchaseAmount),e=Number(a.totalAmount);h.set(b,{paymentCount:c.paymentCount+1,totalAmount:c.totalAmount+d,totalFees:c.totalFees+(e-d)})});let i=Array.from(h.entries()).map(([a,b])=>({date:a,paymentCount:b.paymentCount,totalAmount:b.totalAmount,totalFees:b.totalFees})).sort((a,b)=>a.date.localeCompare(b.date)),j=i.reduce((a,b)=>a+b.paymentCount,0),k=i.reduce((a,b)=>a+b.totalAmount,0),l=i.reduce((a,b)=>a+b.totalFees,0);return{success:!0,data:{stats:i,summary:{totalPaymentCount:j,totalAmount:Math.round(100*k)/100,totalFees:Math.round(100*l)/100,avgAmountPerPayment:Math.round(100*(j>0?k/j:0))/100},period:{type:"monthly",startDate:e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-01",endDate:f.getFullYear()+"-"+String(f.getMonth()+1).padStart(2,"0")+"-"+String(f.getDate()).padStart(2,"0")}},errMsg:"",statusCode:200}}catch(a){return console.error("Payment stats fetch error:",a),{success:!1,data:null,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}}async function n({currentDate:a}){try{let b,c;if(!a.match(/^(\d{4})-(\d{2})-01$/))return{success:!1,data:null,errMsg:"Invalid date format. Use YYYY-MM-01.",statusCode:400};let[d,e]=a.split("-").map(Number),f=new Date,g=!1,h=!1,i=1===e?d-1:d,j=1===e?12:e-1,k=12===e?d+1:d,l=12===e?1:e+1;(g=i>2025||2025===i&&j>=6)&&(b=`${i}-${String(j).padStart(2,"0")}-01`);let m=f.getFullYear(),n=f.getMonth()+1;return(h=k<m||k===m&&l<=n)&&(c=`${k}-${String(l).padStart(2,"0")}-01`),{success:!0,data:{hasPrevious:g,hasNext:h,previousDate:b,nextDate:c},errMsg:"",statusCode:200}}catch(a){return console.error("Payment data availability check error:",a),{success:!1,data:null,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}}(0,f.ensureServerEntryExports)([k,l,m,n]),(0,b.registerServerReference)(k,"7f3f0b7f96cc5a9aec0e7fcb58ae2ba47841e494e4",null),(0,b.registerServerReference)(l,"7f8df3223b34baff3d60eadd829e3d87165ff8cf5f",null),(0,b.registerServerReference)(m,"4046b463a7820584af323f960303194a6925f74d54",null),(0,b.registerServerReference)(n,"401c8248fe363e92b28410dc1083368464cf187423",null)},570398,a=>{"use strict";a.s(["getPointList",()=>h]);var b=a.i(137936),c=a.i(559330),d=a.i(446129),e=a.i(905246),f=a.i(713095);let g=Number("10"),h=async({advertiserId:a,type:b="",sort:f="desc",page:h=1})=>{try{let i=await (0,e.cookies)(),j=i.get("accessToken")?.value;if(!j)return{success:!1,statusCode:401,errMsg:"Unauthorized."};let{result:k,data:l,message:m}=await (0,d.security)({jwtEncodedStr:j,readOnly:!0});if(!k||!l)return{success:!1,statusCode:401,errMsg:m};if(0===a){if("admin"!==l.userType)return{success:!1,statusCode:401,errMsg:"Admin access required."}}else if(l.id!==a)return{success:!1,statusCode:401,errMsg:"Unauthorized."};if(!h||h<1)return{success:!1,statusCode:400,errMsg:"Invalid page number."};let n={};0!==a&&(n.userId=a),b&&("purchase"===b||"consume"===b||"refund"===b)&&(n.type=b);let o=(await c.default.point.findMany({where:n,select:{id:!0,type:!0,amount:!0,description:!0,createdAt:!0,payment:{select:{id:!0,orderId:!0,paymentMethod:!0,totalAmount:!0,status:!0}}},orderBy:{createdAt:f},take:g+1,skip:(h-1)*g})).map(a=>({id:a.id,type:a.type,amount:a.amount.toString(),description:a.description,createdAt:a.createdAt,payment:a.payment?{id:a.payment.id,orderId:a.payment.orderId,paymentMethod:a.payment.paymentMethod,totalAmount:a.payment.totalAmount.toString(),status:a.payment.status}:null}));return{success:!0,statusCode:200,errMsg:"",data:o}}catch(a){return console.error("getPointList error:",a),{success:!1,statusCode:500,errMsg:a instanceof Error?a.message:"Internal Server Error."}}};(0,f.ensureServerEntryExports)([h]),(0,b.registerServerReference)(h,"7feabe2b333ebe61413118bbd8f34d7db76a55eb31",null)},992058,a=>a.a(async(b,c)=>{try{a.s([]);var d=a.i(356697);a.i(545596),a.i(570398);var e=b([d]);[d]=e.then?(await e)():e,c()}catch(a){c(a)}},!1),943242,a=>a.a(async(b,c)=>{try{a.s(["7f2ee3e73a4f61fd029c2911db4802ca19f160e882",()=>e.signUp,"7f3f0b7f96cc5a9aec0e7fcb58ae2ba47841e494e4",()=>f.checkPendingPayments,"7f58b3e156ef73121dd812cf6580f855e0fba2d7b5",()=>e.mailAuth,"7f708aead18bc6fb7cb809355166f217811e0d4cf3",()=>e.signOut,"7fb775272ce06773a1d5c99cf6121ba203f21a336f",()=>e.signIn,"7fd5a47b1466b4921998c4bcc1343f32a8116f9064",()=>e.loginCheck,"7feabe2b333ebe61413118bbd8f34d7db76a55eb31",()=>g.getPointList]);var d=a.i(992058),e=a.i(356697),f=a.i(545596),g=a.i(570398),h=b([d,e]);[d,e]=h.then?(await h)():h,c()}catch(a){c(a)}},!1),820218,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/payment/PaymentPolling.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/payment/PaymentPolling.tsx <module evaluation>","default")},348453,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/payment/PaymentPolling.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/payment/PaymentPolling.tsx","default")},359812,a=>{"use strict";a.i(820218);var b=a.i(348453);a.n(b)},957476,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/point/list/PointList.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/point/list/PointList.tsx <module evaluation>","default")},763334,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/point/list/PointList.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/point/list/PointList.tsx","default")},6050,a=>{"use strict";a.i(957476);var b=a.i(763334);a.n(b)},290827,a=>{"use strict";a.s(["default",()=>i]);var b=a.i(907997);a.i(570396);var c=a.i(673727),d=a.i(800717),e=a.i(297647),f=a.i(17422),g=a.i(359812),h=a.i(6050);async function i({params:a}){let{advertiserId:i}=await a,j=Number(i);return(!j||isNaN(j)||j<=0)&&(0,c.redirect)("/auth/advertiser"),(0,b.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-blue-50 to-indigo-50",children:(0,b.jsxs)("div",{className:"container mx-auto px-4 py-6 max-w-7xl",children:[(0,b.jsx)("div",{className:"mb-8",children:(0,b.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-6",children:[(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl lg:text-4xl font-bold bg-gradient-to-r from-blue-600 to-indigo-600 bg-clip-text text-transparent",children:"ポイント管理"}),(0,b.jsx)("p",{className:"text-gray-600 mt-2",children:"ポイント残高の確認や履歴をご覧いただけます"})]}),(0,b.jsx)(f.default,{})]}),(0,b.jsxs)("div",{className:"flex flex-col sm:flex-row gap-3",children:[(0,b.jsxs)(e.default,{href:`/advertiser/${j}/point/purchase`,className:"group flex items-center justify-center gap-3 bg-gradient-to-r from-blue-500 to-indigo-600 text-white px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",children:[(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"})}),"ポイント購入"]}),(0,b.jsxs)(e.default,{href:`/advertiser/${j}/ads/create`,className:"group flex items-center justify-center gap-3 bg-gradient-to-r from-emerald-500 to-green-600 text-white px-6 py-3 rounded-xl font-semibold shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300",children:[(0,b.jsx)("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"広告作成"]})]})]})}),(0,b.jsxs)("div",{className:"grid xl:grid-cols-8 gap-6",children:[(0,b.jsx)("div",{className:"xl:col-span-3",children:(0,b.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-white/50 shadow-lg overflow-hidden",children:[(0,b.jsx)("div",{className:"bg-gradient-to-r from-orange-50 to-yellow-50 border-b border-orange-100 p-4",children:(0,b.jsxs)("h2",{className:"text-lg font-semibold text-gray-800 flex items-center gap-2",children:[(0,b.jsx)("svg",{className:"w-5 h-5 text-orange-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"})}),"決済状況"]})}),(0,b.jsx)("div",{className:"max-h-80 overflow-y-auto",children:(0,b.jsx)(d.Suspense,{fallback:(0,b.jsx)("div",{className:"p-4",children:(0,b.jsx)("div",{className:"animate-pulse space-y-3",children:[void 0,void 0,void 0].map((a,c)=>(0,b.jsx)("div",{className:"h-16 bg-gray-200 rounded-lg"},c))})}),children:(0,b.jsx)(g.default,{advertiserId:j})})})]})}),(0,b.jsx)("div",{className:"xl:col-span-5",children:(0,b.jsxs)("div",{className:"bg-white/80 backdrop-blur-sm rounded-2xl border border-white/50 shadow-lg",children:[(0,b.jsx)("div",{className:"bg-gradient-to-r from-indigo-50 to-blue-50 border-b border-indigo-100 p-6",children:(0,b.jsxs)("h2",{className:"text-xl font-semibold text-gray-800 flex items-center gap-2",children:[(0,b.jsx)("svg",{className:"w-6 h-6 text-indigo-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})}),"ポイント履歴"]})}),(0,b.jsx)(d.Suspense,{fallback:(0,b.jsx)("div",{className:"p-6",children:(0,b.jsx)("div",{className:"animate-pulse space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsxs)("div",{className:"flex justify-between items-center p-4 border border-gray-200 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("div",{className:"w-10 h-10 bg-gray-200 rounded-full"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded w-32 mb-2"}),(0,b.jsx)("div",{className:"h-3 bg-gray-200 rounded w-24"})]})]}),(0,b.jsx)("div",{className:"h-4 bg-gray-200 rounded w-20"})]},c))})}),children:(0,b.jsx)(h.default,{advertiserId:j})})]})})]})]})})}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__604393f2._.js.map