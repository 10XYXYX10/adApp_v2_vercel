module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},262212,a=>{a.n(a.i(866114))},636685,a=>{a.n(a.i(88402))},545596,a=>{"use strict";a.s(["checkPaymentStatsDataAvailability",()=>n,"checkPendingPayments",()=>k,"getPaymentHistory",()=>l,"getPaymentStatsData",()=>m]);var b=a.i(137936),c=a.i(559330),d=a.i(446129),e=a.i(905246),f=a.i(713095);let g=Number("6"),h=process.env.NOWPAYMENTS_ENDPOINT,i=process.env.NOWPAYMENTS_SECRET_KEY,j=a=>({id:a.id,orderId:a.orderId,provider:a.provider,paymentMethod:a.paymentMethod,transactionId:a.transactionId,totalAmount:a.totalAmount.toString(),currency:a.currency,status:a.status,createdAt:a.createdAt}),k=async({advertiserId:a})=>{try{let b,f=await (0,e.cookies)(),g=f.get("accessToken")?.value;if(!g)return{success:!1,errMsg:"Unauthorized.",statusCode:401,pendingPayments:[],completedPayments:[]};let{result:j,data:k,message:l}=await (0,d.security)({jwtEncodedStr:g,readOnly:!0});if(!j||!k)return{success:!1,statusCode:401,errMsg:l,pendingPayments:[],completedPayments:[]};if(k.id!==a)return{success:!1,statusCode:401,errMsg:"Unauthorized.",pendingPayments:[],completedPayments:[]};let m=await c.default.payment.findMany({where:{userId:a,status:"pending"},select:{id:!0,orderId:!0,paymentMethod:!0,totalAmount:!0,metadata:!0,currency:!0,createdAt:!0,expiredAt:!0,provider:!0,transactionId:!0,purchaseAmount:!0,userId:!0},orderBy:{createdAt:"desc"}});if(0===m.length)return{success:!0,statusCode:200,errMsg:"",pendingPayments:[],completedPayments:[]};let n=[],o=!1;for(let a of m)try{let b="pending",e=a.expiredAt&&new Date>a.expiredAt;if("nowpayments"===a.provider&&a.transactionId)try{let c=await fetch(`${h}/payment/${a.transactionId}`,{method:"GET",headers:{"x-api-key":i}});if(c.ok)switch((await c.json()).payment_status){case"finished":case"confirmed":b="completed";break;case"failed":case"refunded":b="failed";break;case"expired":b="expired";break;default:b="pending"}else e&&(b="expired")}catch(c){console.error(`NOWPayments API call failed for payment ${a.id}:`,c),e&&(b="expired")}else e&&(b="expired");"pending"!==b&&await c.default.$transaction(async c=>{let e=null,f=null,g=await c.payment.update({where:{id:a.id},data:{status:b}});if("completed"===b){let b=`payment-${a.id}`;if(!await c.point.findUnique({where:{uniqueKey:b}})){let g=await c.point.create({data:{userId:a.userId,type:"purchase",amount:a.purchaseAmount,description:`仮想通貨決済によるポイント購入 (${a.paymentMethod?.toUpperCase()}) - 自動確認`,uniqueKey:b,paymentId:a.id}}),{amount:h}=await c.user.update({where:{id:a.userId},data:{amount:{increment:a.purchaseAmount}}}),{result:i,message:j}=await (0,d.saveAccessTokenInCookies)({id:k.id,name:k.name,userType:"advertiser",amount:Number(h)});if(!i)throw Error(j);e=g.id,f=a.purchaseAmount.toString(),o=!0}}n.push({id:g.id,orderId:g.orderId,paymentMethod:a.paymentMethod,totalAmount:a.totalAmount.toString(),currency:a.currency,status:b,completedAt:new Date,pointId:e,pointAmount:f})})}catch(b){console.error(`Error processing payment ${a.id}:`,b)}let p=m.filter(a=>!n.some(b=>b.id===a.id)).map(a=>({id:a.id,orderId:a.orderId,paymentMethod:a.paymentMethod,totalAmount:a.totalAmount.toString(),currency:a.currency,createdAt:a.createdAt,expiredAt:a.expiredAt,provider:a.provider}));if(o){let d=await c.default.user.findUnique({where:{id:a},select:{amount:!0}});d&&(b=d.amount.toString())}return{success:!0,statusCode:200,errMsg:"",pendingPayments:p,completedPayments:n,newBalance:b}}catch(a){return console.error("checkPendingPayments error:",a),{success:!1,statusCode:500,errMsg:a instanceof Error?a.message:"Internal Server Error.",pendingPayments:[],completedPayments:[]}}},l=async({advertiserId:a,page:b})=>{try{let f=await (0,e.cookies)(),h=f.get("accessToken")?.value;if(!h)return{success:!1,errMsg:"Unauthorized.",statusCode:401};let{result:i,data:k,message:l}=await (0,d.security)({jwtEncodedStr:h,readOnly:!0});if(!i||!k)return{success:!1,statusCode:401,errMsg:l};if(0===a){if("admin"!==k.userType)return{success:!1,statusCode:401,errMsg:"Admin access required."}}else if(k.id!==a)return{success:!1,statusCode:401,errMsg:"Unauthorized."};if(!b||b<1)return{success:!1,statusCode:400,errMsg:"Invalid page number."};let m=await c.default.payment.findMany({where:{...0!==a?{advertiserId:a}:{},status:"pending"},select:{id:!0,orderId:!0,provider:!0,paymentMethod:!0,transactionId:!0,totalAmount:!0,currency:!0,status:!0,createdAt:!0,metadata:!0,...0===a?{user:{select:{id:!0,name:!0}}}:{}},orderBy:{createdAt:"desc"}}),n=await c.default.payment.findMany({where:{...0!==a?{advertiserId:a}:{},status:{not:"pending"}},select:{id:!0,orderId:!0,provider:!0,paymentMethod:!0,transactionId:!0,totalAmount:!0,currency:!0,status:!0,createdAt:!0,metadata:!0,...0===a?{user:{select:{id:!0,name:!0}}}:{}},orderBy:{createdAt:"desc"},take:g+1,skip:(b-1)*g}),o=m.map(b=>({...j(b),...0===a&&b.user?{userName:b.user.name,advertiserIdInfo:b.user.id}:{}})),p=n.map(b=>({...j(b),...0===a&&b.user?{userName:b.user.name,advertiserIdInfo:b.user.id}:{}}));return{success:!0,statusCode:200,errMsg:"",data:p,pendingData:o}}catch(a){return console.error("getPaymentHistory error:",a),{success:!1,statusCode:500,errMsg:a instanceof Error?a.message:"Internal Server Error."}}};async function m({startDate:a}){try{let b,d;if(a){let[c,e]=a.split("-");if(b=Number(c),d=Number(e)-1,isNaN(b)||isNaN(d)||d<0||d>11)return{success:!1,data:null,errMsg:"Invalid date format. Use YYYY-MM-01.",statusCode:400}}else{let a=new Date;b=a.getFullYear(),d=a.getMonth()}let e=new Date(b,d,1,0,0,0,0),f=new Date(b,d+1,0,23,59,59,999),g=await c.default.payment.findMany({where:{status:"completed",createdAt:{gte:e,lte:f}},select:{createdAt:!0,purchaseAmount:!0,totalAmount:!0},orderBy:{createdAt:"asc"}}),h=new Map;g.forEach(a=>{let b=a.createdAt.getFullYear()+"-"+String(a.createdAt.getMonth()+1).padStart(2,"0")+"-"+String(a.createdAt.getDate()).padStart(2,"0"),c=h.get(b)||{paymentCount:0,totalAmount:0,totalFees:0},d=Number(a.purchaseAmount),e=Number(a.totalAmount);h.set(b,{paymentCount:c.paymentCount+1,totalAmount:c.totalAmount+d,totalFees:c.totalFees+(e-d)})});let i=Array.from(h.entries()).map(([a,b])=>({date:a,paymentCount:b.paymentCount,totalAmount:b.totalAmount,totalFees:b.totalFees})).sort((a,b)=>a.date.localeCompare(b.date)),j=i.reduce((a,b)=>a+b.paymentCount,0),k=i.reduce((a,b)=>a+b.totalAmount,0),l=i.reduce((a,b)=>a+b.totalFees,0);return{success:!0,data:{stats:i,summary:{totalPaymentCount:j,totalAmount:Math.round(100*k)/100,totalFees:Math.round(100*l)/100,avgAmountPerPayment:Math.round(100*(j>0?k/j:0))/100},period:{type:"monthly",startDate:e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-01",endDate:f.getFullYear()+"-"+String(f.getMonth()+1).padStart(2,"0")+"-"+String(f.getDate()).padStart(2,"0")}},errMsg:"",statusCode:200}}catch(a){return console.error("Payment stats fetch error:",a),{success:!1,data:null,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}}async function n({currentDate:a}){try{let b,c;if(!a.match(/^(\d{4})-(\d{2})-01$/))return{success:!1,data:null,errMsg:"Invalid date format. Use YYYY-MM-01.",statusCode:400};let[d,e]=a.split("-").map(Number),f=new Date,g=!1,h=!1,i=1===e?d-1:d,j=1===e?12:e-1,k=12===e?d+1:d,l=12===e?1:e+1;(g=i>2025||2025===i&&j>=6)&&(b=`${i}-${String(j).padStart(2,"0")}-01`);let m=f.getFullYear(),n=f.getMonth()+1;return(h=k<m||k===m&&l<=n)&&(c=`${k}-${String(l).padStart(2,"0")}-01`),{success:!0,data:{hasPrevious:g,hasNext:h,previousDate:b,nextDate:c},errMsg:"",statusCode:200}}catch(a){return console.error("Payment data availability check error:",a),{success:!1,data:null,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}}(0,f.ensureServerEntryExports)([k,l,m,n]),(0,b.registerServerReference)(k,"7f3f0b7f96cc5a9aec0e7fcb58ae2ba47841e494e4",null),(0,b.registerServerReference)(l,"7f8df3223b34baff3d60eadd829e3d87165ff8cf5f",null),(0,b.registerServerReference)(m,"4046b463a7820584af323f960303194a6925f74d54",null),(0,b.registerServerReference)(n,"401c8248fe363e92b28410dc1083368464cf187423",null)},10091,a=>a.a(async(b,c)=>{try{a.s([]);var d=a.i(356697);a.i(545596);var e=b([d]);[d]=e.then?(await e)():e,c()}catch(a){c(a)}},!1),131376,a=>a.a(async(b,c)=>{try{a.s(["401c8248fe363e92b28410dc1083368464cf187423",()=>f.checkPaymentStatsDataAvailability,"4046b463a7820584af323f960303194a6925f74d54",()=>f.getPaymentStatsData,"7f2ee3e73a4f61fd029c2911db4802ca19f160e882",()=>e.signUp,"7f3f0b7f96cc5a9aec0e7fcb58ae2ba47841e494e4",()=>f.checkPendingPayments,"7f58b3e156ef73121dd812cf6580f855e0fba2d7b5",()=>e.mailAuth,"7f708aead18bc6fb7cb809355166f217811e0d4cf3",()=>e.signOut,"7f8df3223b34baff3d60eadd829e3d87165ff8cf5f",()=>f.getPaymentHistory,"7fb775272ce06773a1d5c99cf6121ba203f21a336f",()=>e.signIn,"7fd5a47b1466b4921998c4bcc1343f32a8116f9064",()=>e.loginCheck]);var d=a.i(10091),e=a.i(356697),f=a.i(545596),g=b([d,e]);[d,e]=g.then?(await g)():g,c()}catch(a){c(a)}},!1),258723,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/payment/PaymentOverview.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/payment/PaymentOverview.tsx <module evaluation>","default")},342200,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/payment/PaymentOverview.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/payment/PaymentOverview.tsx","default")},134349,a=>{"use strict";a.i(258723);var b=a.i(342200);a.n(b)},47325,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/payment/PaymentHistoryForAdmin.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/payment/PaymentHistoryForAdmin.tsx <module evaluation>","default")},897877,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/payment/PaymentHistoryForAdmin.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/payment/PaymentHistoryForAdmin.tsx","default")},371417,a=>{"use strict";a.i(47325);var b=a.i(897877);a.n(b)},220768,a=>{"use strict";a.s(["default",()=>f]);var b=a.i(907997);a.i(570396);var c=a.i(673727),d=a.i(134349),e=a.i(371417);async function f({params:a}){let f=Number((await a).adminId);return(!f||isNaN(f)||f<=0)&&(0,c.redirect)("/auth/admin"),(0,b.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 via-blue-50/30 to-purple-50/40 relative overflow-hidden",children:[(0,b.jsxs)("div",{className:"absolute inset-0 overflow-hidden pointer-events-none",children:[(0,b.jsx)("div",{className:"absolute -top-40 -right-40 w-80 h-80 bg-gradient-to-br from-blue-400/20 to-purple-400/20 rounded-full blur-3xl"}),(0,b.jsx)("div",{className:"absolute -bottom-40 -left-40 w-80 h-80 bg-gradient-to-tr from-cyan-400/20 to-indigo-400/20 rounded-full blur-3xl"})]}),(0,b.jsxs)("div",{className:"relative z-10 max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8",children:[(0,b.jsxs)("div",{className:"text-center space-y-4",children:[(0,b.jsxs)("div",{className:"inline-flex items-center gap-3 bg-white/70 backdrop-blur-xl rounded-full px-6 py-3 shadow-lg border border-white/40",children:[(0,b.jsx)("div",{className:"w-8 h-8 bg-gradient-to-r from-green-500 to-emerald-600 rounded-full flex items-center justify-center",children:(0,b.jsx)("svg",{className:"w-4 h-4 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})})}),(0,b.jsx)("h1",{className:"text-2xl sm:text-3xl font-bold bg-gradient-to-r from-gray-900 via-green-900 to-emerald-900 bg-clip-text text-transparent",children:"決済管理ダッシュボード"})]}),(0,b.jsx)("p",{className:"text-gray-600 text-lg max-w-2xl mx-auto",children:"全ユーザーの決済状況を統合管理し、売上分析とリアルタイム監視を実現"})]}),(0,b.jsx)(d.default,{}),(0,b.jsx)(e.default,{adminId:f}),(0,b.jsx)("div",{className:"text-center pt-8",children:(0,b.jsxs)("div",{className:"inline-flex items-center gap-2 text-gray-400 text-sm",children:[(0,b.jsx)("div",{className:"w-1 h-1 bg-gray-300 rounded-full"}),(0,b.jsx)("span",{children:"決済データはリアルタイムで更新されます"}),(0,b.jsx)("div",{className:"w-1 h-1 bg-gray-300 rounded-full"})]})})]}),(0,b.jsx)("div",{className:"absolute inset-0 bg-grid-gray-100/50 [mask-image:radial-gradient(ellipse_at_center,transparent_20%,black)] pointer-events-none"})]})}}];

//# sourceMappingURL=%5Broot-of-the-server%5D__a37318af._.js.map