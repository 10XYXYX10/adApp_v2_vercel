module.exports=[193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},262212,a=>{a.n(a.i(866114))},636685,a=>{a.n(a.i(88402))},701067,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/point/advertiser/purchase/crypt/PurchaseEntryForm.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/point/advertiser/purchase/crypt/PurchaseEntryForm.tsx <module evaluation>","default")},769400,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/point/advertiser/purchase/crypt/PurchaseEntryForm.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/point/advertiser/purchase/crypt/PurchaseEntryForm.tsx","default")},739310,a=>{"use strict";a.i(701067);var b=a.i(769400);a.n(b)},526194,a=>{"use strict";a.s(["default",()=>f]);var b=a.i(907997),c=a.i(739310),d=a.i(297647);a.i(570396);var e=a.i(673727);async function f({params:a}){let f=Number((await a).advertiserId);return(!f||isNaN(f)||f<0)&&(0,e.redirect)("/auth/advertiser"),(0,b.jsxs)("div",{className:"container mx-auto px-4 py-8 max-w-4xl",children:[(0,b.jsxs)("div",{className:"mb-8",children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"仮想通貨決済"}),(0,b.jsx)("p",{className:"text-gray-600",children:"仮想通貨でポイントを購入します"})]}),(0,b.jsx)("div",{className:"mb-8",children:(0,b.jsxs)(d.default,{href:`/advertiser/${f}/point/purchase`,className:"inline-flex items-center text-blue-600 hover:text-blue-800 transition-colors",children:[(0,b.jsx)("svg",{className:"w-4 h-4 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})}),"決済方法選択に戻る"]})}),(0,b.jsxs)("div",{className:"mb-8 bg-green-50 border border-green-200 rounded-xl p-6",children:[(0,b.jsxs)("h2",{className:"text-lg font-semibold text-green-800 mb-4 flex items-center",children:[(0,b.jsx)("svg",{className:"w-6 h-6 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"})}),"仮想通貨決済について"]}),(0,b.jsxs)("div",{className:"grid md:grid-cols-2 gap-4 text-sm",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-green-800 mb-2",children:"対応通貨"}),(0,b.jsxs)("ul",{className:"text-green-700 space-y-1",children:[(0,b.jsx)("li",{children:"• Bitcoin (BTC)"}),(0,b.jsx)("li",{children:"• Ethereum (ETH)"}),(0,b.jsx)("li",{children:"• Litecoin (LTC) - 推奨"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-green-800 mb-2",children:"決済情報"}),(0,b.jsxs)("ul",{className:"text-green-700 space-y-1",children:[(0,b.jsx)("li",{children:"• 手数料: 1.5%"}),(0,b.jsx)("li",{children:"• 決済時間: 数分～数十分程度"}),(0,b.jsx)("li",{children:"• ガス代別途必要"})]})]})]})]}),(0,b.jsx)(c.default,{advertiserId:f,paymentType:"crypt"}),(0,b.jsxs)("div",{className:"mb-8 bg-yellow-50 border border-yellow-200 rounded-xl p-6",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold text-yellow-800 mb-4 flex items-center",children:[(0,b.jsx)("svg",{className:"w-6 h-6 mr-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16c-.77.833.192 2.5 1.732 2.5z"})}),"重要な注意事項"]}),(0,b.jsxs)("div",{className:"text-sm text-yellow-800 space-y-2",children:[(0,b.jsx)("p",{children:"• 送金時に別途ガス代（ネットワーク手数料）が必要です"}),(0,b.jsx)("p",{children:"• Litecoinはガス代が最も安く、送金速度も速いためおすすめです"}),(0,b.jsx)("p",{children:"• 決済の有効期限は60分です"}),(0,b.jsxs)("p",{children:["• アプリケーションの仕様上、",(0,b.jsx)("br",{}),"　ポイントの返金は出来ませんのでご注文下さい"]})]})]})]})}},176491,a=>{"use strict";a.s(["checkCryptoPaymentStatus",()=>l,"createCryptoPayment",()=>k]);var b=a.i(137936),c=a.i(559330),d=a.i(446129),e=a.i(905246),f=a.i(713095);let g="http://localhost:3000",h={ltc:{nowPaymentsCurrency:"ltc",name:"Litecoin",symbol:"LTC"},eth:{nowPaymentsCurrency:"eth",name:"Ethereum",symbol:"ETH"},btc:{nowPaymentsCurrency:"btc",name:"Bitcoin",symbol:"BTC"}},i=process.env.NOWPAYMENTS_ENDPOINT,j=process.env.NOWPAYMENTS_SECRET_KEY,k=async({advertiserId:a,currency:b,totalAmount:e,purchaseAmount:f})=>{try{let k,{result:l,data:m,message:n}=await (0,d.security)({readOnly:!1});if(!l||!m)return{success:!1,errMsg:n,statusCode:401};let{id:o}=m;if(o!==a)return{success:!1,errMsg:"Unauthorized.",statusCode:401};if(!f||f<100||f>1e5)return{success:!1,errMsg:"Invalid amount.",statusCode:400};if(!h[b])return{success:!1,errMsg:"Invalid currency.",statusCode:400};let p=`order_${a}_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,q={price_amount:5,price_currency:"usd",pay_currency:h[b].nowPaymentsCurrency,order_id:p,order_description:`ポイント購入 - purchaseAmount:${f}, totalAmount:${e}`,ipn_callback_url:`${g}/api/nowpayment/ipn`,success_url:`${g}/advertiser/${a}/point/purchase/success`,cancel_url:`${g}/advertiser/${a}/point/purchase/crypto`};try{let a=await fetch(`${i}/payment`,{method:"POST",headers:{"Content-Type":"application/json","x-api-key":j},body:JSON.stringify(q)});if(!a.ok){let b=await a.text();throw console.error("NOWPayments API Error:",a.status,b),Error(`NOWPayments API error: ${a.status}`)}k=await a.json()}catch(a){return console.error("NOWPayments API call failed:",a),{success:!1,errMsg:"Payment service temporarily unavailable.",statusCode:503}}let r=new Date(Date.now()+432e6),s={id:(await c.default.payment.create({data:{userId:a,orderId:p,provider:"nowpayments",paymentMethod:h[b].nowPaymentsCurrency,transactionId:k.payment_id,purchaseAmount:f,totalAmount:e,currency:"JPY",status:"pending",expiredAt:r,metadata:{nowPaymentsData:k,payAddress:k.pay_address,payAmount:k.pay_amount,payCurrency:k.pay_currency}},select:{id:!0}})).id,transactionId:k.payment_id,orderId:p,payAddress:k.pay_address,payAmount:k.pay_amount.toString(),paymentUrl:k.payment_url,expiredAt:r.toISOString(),currency:h[b].symbol};return{success:!0,errMsg:"",statusCode:200,paymentData:s}}catch(a){return console.error("createCryptoPayment error:",a),{success:!1,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}},l=async({transactionId:a})=>{try{let b,f,g=await (0,e.cookies)(),h=g.get("accessToken")?.value;if(!h)return{success:!1,errMsg:"Unauthorized.",statusCode:401};let{result:k,data:l,message:m}=await (0,d.security)({jwtEncodedStr:h,readOnly:!0});if(!k||!l)return{success:!1,errMsg:m,statusCode:401};let n=l.id,o=await c.default.payment.findFirst({where:{transactionId:a,userId:n}});if(!o)return{success:!1,errMsg:"Payment not found.",statusCode:404};if("completed"===o.status)return{success:!0,errMsg:"",statusCode:200,status:"completed",transactionId:o.transactionId||void 0};try{let c=await fetch(`${i}/payment/${a}`,{method:"GET",headers:{"x-api-key":j}});if(!c.ok)return console.error("NOWPayments status check failed:",c.status),{success:!0,errMsg:"",statusCode:200,status:o.status};b=await c.json()}catch(a){return console.error("NOWPayments status API error:",a),{success:!0,errMsg:"",statusCode:200,status:o.status}}if(o.expiredAt&&new Date>o.expiredAt&&"finished"!==b.payment_status&&"confirmed"!==b.payment_status){let a;return a="failed"===b.payment_status||"refunded"===b.payment_status?"failed":"expired",await c.default.payment.update({where:{id:o.id},data:{status:a,metadata:{...o.metadata||{},nowPaymentsStatus:b,expiredAt:new Date().toISOString()}}}),{success:!0,errMsg:"",statusCode:200,status:a}}switch(b.payment_status){case"finished":case"confirmed":f="completed";break;case"failed":case"refunded":f="failed";break;case"expired":f="expired";break;default:f="pending"}return f!==o.status&&await c.default.$transaction(async a=>{if(await a.payment.update({where:{id:o.id},data:{status:f,metadata:{...o.metadata||{},nowPaymentsStatus:b}}}),"completed"===f){let b=`payment-${o.id}`;if(!await a.point.findUnique({where:{uniqueKey:b}})){await a.point.create({data:{userId:o.userId,type:"purchase",amount:o.purchaseAmount,description:`仮想通貨決済によるポイント購入 (${o.paymentMethod?.toUpperCase()})`,uniqueKey:b,paymentId:o.id}});let{amount:c}=await a.user.update({where:{id:o.userId},data:{amount:{increment:o.purchaseAmount}},select:{amount:!0}}),{result:e,message:f}=await (0,d.saveAccessTokenInCookies)({id:n,name:l.name,userType:"advertiser",amount:Number(c)});if(!e)throw Error(f)}}}),{success:!0,errMsg:"",statusCode:200,status:f,transactionId:o.transactionId||void 0}}catch(a){return console.error("checkCryptoPaymentStatus error:",a),{success:!1,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}};(0,f.ensureServerEntryExports)([k,l]),(0,b.registerServerReference)(k,"7fd7fb6dd5442bc160177033d881556836a6f7b03a",null),(0,b.registerServerReference)(l,"7f459ea1a4c1f8e4460291ad964a00bdc2458dacb7",null)},525251,a=>a.a(async(b,c)=>{try{a.s([]);var d=a.i(356697);a.i(176491);var e=b([d]);[d]=e.then?(await e)():e,c()}catch(a){c(a)}},!1),162185,a=>a.a(async(b,c)=>{try{a.s(["7f2ee3e73a4f61fd029c2911db4802ca19f160e882",()=>e.signUp,"7f459ea1a4c1f8e4460291ad964a00bdc2458dacb7",()=>f.checkCryptoPaymentStatus,"7f58b3e156ef73121dd812cf6580f855e0fba2d7b5",()=>e.mailAuth,"7f708aead18bc6fb7cb809355166f217811e0d4cf3",()=>e.signOut,"7fb775272ce06773a1d5c99cf6121ba203f21a336f",()=>e.signIn,"7fd5a47b1466b4921998c4bcc1343f32a8116f9064",()=>e.loginCheck,"7fd7fb6dd5442bc160177033d881556836a6f7b03a",()=>f.createCryptoPayment]);var d=a.i(525251),e=a.i(356697),f=a.i(176491),g=b([d,e]);[d,e]=g.then?(await g)():g,c()}catch(a){c(a)}},!1)];

//# sourceMappingURL=%5Broot-of-the-server%5D__2739d294._.js.map