module.exports=[29173,(a,b,c)=>{b.exports=a.x("@prisma/client",()=>require("@prisma/client"))},559330,a=>{"use strict";a.s(["default",()=>c]);var b=a.i(29173);let c=globalThis.prismaGlobal??new b.PrismaClient},478721,a=>{"use strict";a.s(["dangerousCharToEntity",()=>d,"dangerousCharToSpace",()=>b,"entityToDangerousChar",()=>g,"validateSimpleYouTubeId",()=>m,"validationForAuthenticationPassword",()=>k,"validationForEmail",()=>i,"validationForPassword",()=>j,"validationForPhoneNumber",()=>l,"validationForWord",()=>h]);let b=a=>a?a.replace(/[<>&|"'`;　=%?!\\]/g,()=>" "):"",c={"<":"&lt;",">":"&gt;","/":"&#x2f;","&":"&amp;","|":"&#x7c;",'"':"&quot;","'":"&#x27;","`":"&#x60;",";":"；","=":"&#x3d;","%":"&#x25;","?":"&#x3f;","!":"&#x21;","#":"&#x23;","@":"&#x40;","*":"&#x2a;","\\":"&#092;","+":"&#x2b;","-":"&#x2d;"},d=a=>a?a.replace(/[<>/&|"'`;=%?!#@*\\\+\-]/g,a=>c[a]):"",e={"&lt;":"<","&gt;":">","&#x2f;":"/","&amp;":"&","&#x7c;":"|","&quot;":'"',"&#x27;":"'","&#x60;":"`","&#059;":";","；":";","&#x3d;":"=","&#x25;":"%","&#x3f;":"?","&#x21;":"!","&#x23;":"#","&#x40;":"@","&#x2a;":"*","&#092;":"\\","&#x2b;":"+","&#x2d;":"-"},f={"&lt;":"＜","&gt;":"＞","&#x2f;":"／","&amp;":"＆","&#x7c;":"｜","&quot;":"”","&#x27;":"’","&#x60;":"‘","&#059;":"；","&#x3d;":"＝","&#x25;":"％","&#x3f;":"？","&#x21;":"！","&#x23;":"＃","&#x40;":"＠","&#x2a;":"＊","&#092;":"＼","&#x2b;":"＋","&#x2d;":"ー"},g=(a,b="half")=>{if(!a)return"";let c="half"===b?e:f;return a.replace(/(&lt;|&gt;|&#x2f;|&amp;|&#x7c;|&quot;|&#x27;|&#x60;|&#059;|&#x3d;|&#x25;|&#x3f;|&#x21;|&#x23;|&#x40;|&#x2a;|&#092;|&#x2b;|&#x2d;)/g,a=>c[a])},h=(a,b=20)=>0===a.length||a.length>b?{result:!1,message:`1～${b}字以内の文字列を入力して下さい`}:/[<>/&|"'`;=%?!#@*\\\+\-]/.test(a)?{result:!1,message:"半角の「<>/&|\"'`;=%?!#@*\\+-」は使用不可"}:{result:!0,message:"success"},i=a=>0===a.length||a.length>50?{result:!1,message:"1～50字以内のメールアドレを入力して下さい"}:/^[a-zA-Z0-9]+[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/.test(a)?{result:!0,message:"success"}:{result:!1,message:"有効なメールアドレスの形式でありません"},j=a=>a.length<5||a.length>50?{result:!1,message:"5～50字以内の半角の英数字を入力して下さい"}:/^[A-Za-z0-9]+$/.test(a)?{result:!0,message:"success"}:{result:!1,message:"半角の英数字で入力して下さい"},k=a=>6!==a.length?{result:!1,message:"6桁の半角数字を入力して下さい"}:/^[0-9]+$/.test(a)?{result:!0,message:"success"}:{result:!1,message:"半角数字で入力して下さい"},l=a=>{if(11!==a.length)return{result:!1,message:"11桁の半角数字を入力して下さい"};if(!/^0[7-9]0\d{8}$/.test(a))return{result:!1,message:"070,080,090のいずれかで始まる11桁の半角数字を入力して下さい"};let b=a.slice(3,7),c=a.slice(7,11),d=/(\d)\1{3}/;if(d.test(b)&&d.test(c))return{result:!1,message:"同じ数字が4回連続している部分があります"};let e=a.slice(3,11);return"01234567"===e||"12345678"===e||"23456789"===e||"76543210"===e||"87654321"===e||"98765432"===e?{result:!1,message:"8桁の連番が含まれています"}:{result:!0,message:"success"}},m=async a=>{let b=a.trim();if(!b)return{exists:!1,error:"YouTube動画IDが空です"};if(!/^[a-zA-Z0-9_-]{11}$/.test(b))return{exists:!1,error:"YouTube動画IDの形式が正しくありません"};try{let a=await fetch(`https://www.youtube.com/oembed?url=https://www.youtube.com/watch?v=${b}&format=json`,{method:"GET",signal:AbortSignal.timeout(5e3)});if(console.log(`YouTube validation response status: ${a.status} for videoId: ${b}`),200===a.status){let b=await a.json();if(b&&b.title&&b.html)return{exists:!0};return{exists:!1,error:"YouTube動画の情報を取得できませんでした"}}if(404===a.status)return{exists:!1,error:"YouTube動画が見つかりません"};if(401===a.status||403===a.status)return{exists:!1,error:"YouTube動画にアクセスできません（非公開またはプライベート動画）"};else return{exists:!1,error:`YouTube動画の確認でエラーが発生しました（ステータス: ${a.status}）`}}catch(a){if(console.error("YouTube validation error:",a),a instanceof Error){if("AbortError"===a.name)return{exists:!1,error:"YouTube動画の確認がタイムアウトしました"};else if(a.message.includes("fetch"))return{exists:!1,error:"ネットワークエラーが発生しました"}}return{exists:!1,error:"YouTube動画の確認に失敗しました"}}}},792509,(a,b,c)=>{b.exports=a.x("url",()=>require("url"))},524836,(a,b,c)=>{b.exports=a.x("https",()=>require("https"))},921517,(a,b,c)=>{b.exports=a.x("http",()=>require("http"))},504446,(a,b,c)=>{b.exports=a.x("net",()=>require("net"))},755004,(a,b,c)=>{b.exports=a.x("tls",()=>require("tls"))},254799,(a,b,c)=>{b.exports=a.x("crypto",()=>require("crypto"))},427699,(a,b,c)=>{b.exports=a.x("events",()=>require("events"))},522734,(a,b,c)=>{b.exports=a.x("fs",()=>require("fs"))},406461,(a,b,c)=>{b.exports=a.x("zlib",()=>require("zlib"))},688947,(a,b,c)=>{b.exports=a.x("stream",()=>require("stream"))},446786,(a,b,c)=>{b.exports=a.x("os",()=>require("os"))},233405,(a,b,c)=>{b.exports=a.x("child_process",()=>require("child_process"))},193695,(a,b,c)=>{b.exports=a.x("next/dist/shared/lib/no-fallback-error.external.js",()=>require("next/dist/shared/lib/no-fallback-error.external.js"))},262212,a=>{a.n(a.i(866114))},367782,a=>{a.n(a.i(890430))},470765,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/auth/resetPass/ResetPassRequest.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/auth/resetPass/ResetPassRequest.tsx <module evaluation>","default")},959210,a=>{"use strict";a.s(["default",()=>b]);let b=(0,a.i(211857).registerClientReference)(function(){throw Error("Attempted to call the default export of [project]/src/components/auth/resetPass/ResetPassRequest.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"[project]/src/components/auth/resetPass/ResetPassRequest.tsx","default")},903890,a=>{"use strict";a.i(470765);var b=a.i(959210);a.n(b)},500141,a=>{"use strict";a.s(["default",()=>d]);var b=a.i(907997),c=a.i(903890);let d=()=>(0,b.jsx)(c.default,{})},815439,a=>{"use strict";a.s(["7f3cf419ca948d5c81643d82138ee6f53477733601",()=>k,"7f9323e44328f09cf8976da907c58c42101017d087",()=>l],815439),a.s([],391065);var b=a.i(137936),c=a.i(478721),d=a.i(446129),e=a.i(559330),f=a.i(275343),g=a.i(248830);a.i(570396);var h=a.i(673727),i=a.i(121419),j=a.i(713095);let k=async(a,b)=>{try{let{success:f,message:h}=await (0,g.rateLimit)();if(!f)return{...a,errMsg:h};let j=b.get("email");if(!j||!(0,c.validationForEmail)(j).result)return{...a,errMsg:"Bad request error."};let k=await e.default.user.findFirst({where:{email:j,verifiedEmail:!0,isActive:!0}});if(!k)return{...a,errMsg:"The value you entered is incorrect. Please try again."};let l=(0,d.generateRandomNumber6)();return await e.default.$transaction(async a=>{await a.user.update({where:{id:k.id},data:{authenticationPassword:l,updatedAt:new Date}});let{result:b,message:c}=await (0,i.sendMail)({toEmail:j,subject:"二段階認証パスワード",text:"以下のパスワードを入力し、メールアドレス認証を完了させて下さい。有効期限は3分です。",html:`
                    <p>以下のパスワードを入力し、メールアドレス認証を完了させて下さい。有効期限は3分です。</p>
                    <br/>
                    <p>${l}</p>
                `});if(!b)throw Error(c)},{maxWait:1e4,timeout:25e3}).catch(a=>{throw a}),{success:!0,errMsg:""}}catch(b){return{...a,errMsg:b instanceof Error?b.message:"Internal Server Error."}}},l=async(a,b)=>{let i=0,j="advertiser";try{let{success:h,message:k}=await (0,g.rateLimit)();if(!h)return{...a,errMsg:k};let l=b.get("email"),m=b.get("password"),n=b.get("authenticationPassword");if(!l||!n||!m)return{errMsg:"Bad request error."};let o=(0,c.validationForEmail)(l);if(!o.result||!(o=(0,c.validationForPassword)(m)).result||!(o=(0,c.validationForAuthenticationPassword)(n)).result)return{errMsg:"Bad request error."};let p=await e.default.user.findUnique({where:{email:l}});if(!p)return{errMsg:"Something went wrong. Please try again."};if(i=p.id,j="admin"===p.userType?"admin":"advertiser",!p.verifiedEmail)return{errMsg:"That user is disabled. SMS authentication has not been completed."};if(p.authenticationPassword!==n)return{errMsg:"Authentication password is incorrect."};let q=p.updatedAt;if((new Date().getTime()-q.getTime())/6e4>=3)return{errMsg:"More than 3 minutes have passed. Please try again."};let r=await f.hash(m,11);await e.default.user.update({where:{id:p.id},data:{hashedPassword:r}});let s=await (0,d.saveAccessTokenInCookies)({id:i,name:p.name,userType:j,amount:Number(p.amount)});if(!s.result)throw Error(s.message)}catch(a){return{errMsg:a instanceof Error?a.message:"Internal Server Error."}}(0,h.redirect)(`/${j}/${i}`)};(0,j.ensureServerEntryExports)([k,l]),(0,b.registerServerReference)(k,"7f3cf419ca948d5c81643d82138ee6f53477733601",null),(0,b.registerServerReference)(l,"7f9323e44328f09cf8976da907c58c42101017d087",null),a.i(391065)}];

//# sourceMappingURL=%5Broot-of-the-server%5D__b36e7912._.js.map