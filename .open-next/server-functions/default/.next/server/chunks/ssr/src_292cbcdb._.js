module.exports=[887199,a=>{"use strict";a.s(["checkAdStatsDataAvailability",()=>d,"getAdStatsData",()=>c]);var b=a.i(559330);async function c({userId:a,startDate:c}){try{let d,e;if(a&&a<=0)return{success:!1,data:null,errMsg:"Invalid user ID.",statusCode:400};if(c){let[a,b]=c.split("-");if(d=Number(a),e=Number(b)-1,isNaN(d)||isNaN(e)||e<0||e>11)return{success:!1,data:null,errMsg:"Invalid date format. Use YYYY-MM-01.",statusCode:400}}else{let a=new Date;d=a.getFullYear(),e=a.getMonth()}let f=new Date(d,e,1,0,0,0,0),g=new Date(d,e+1,0,23,59,59,999),h=(await b.default.adStats.groupBy({by:["date"],where:{...a?{userId:a}:{},date:{gte:f,lte:g}},_sum:{impressions:!0,clicks:!0,spentPoints:!0},orderBy:{date:"asc"}})).map(a=>({date:a.date.getFullYear()+"-"+String(a.date.getMonth()+1).padStart(2,"0")+"-"+String(a.date.getDate()).padStart(2,"0"),impressions:a._sum.impressions||0,clicks:a._sum.clicks||0,spentPoints:Number(a._sum.spentPoints)||0})),i=h.reduce((a,b)=>a+b.impressions,0),j=h.reduce((a,b)=>a+b.clicks,0),k=h.reduce((a,b)=>a+b.spentPoints,0);return{success:!0,data:{stats:h,summary:{totalImpressions:i,totalClicks:j,totalSpentPoints:k,ctr:Math.round(100*(i>0?j/i*100:0))/100,cpc:Math.round(100*(j>0?k/j:0))/100},period:{type:"monthly",startDate:f.getFullYear()+"-"+String(f.getMonth()+1).padStart(2,"0")+"-01",endDate:g.getFullYear()+"-"+String(g.getMonth()+1).padStart(2,"0")+"-"+String(g.getDate()).padStart(2,"0")}},errMsg:"",statusCode:200}}catch(a){return console.error("AdStats fetch error:",a),{success:!1,data:null,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}}async function d({userId:a,currentDate:b}){try{let c,d;if(a&&a<=0)return{success:!1,data:null,errMsg:"Invalid user ID.",statusCode:400};if(!b.match(/^(\d{4})-(\d{2})-01$/))return{success:!1,data:null,errMsg:"Invalid date format. Use YYYY-MM-01.",statusCode:400};let[e,f]=b.split("-").map(Number),g=new Date,h=!1,i=!1,j=1===f?e-1:e,k=1===f?12:f-1,l=12===f?e+1:e,m=12===f?1:f+1;(h=j>2025||2025===j&&k>=8)&&(c=`${j}-${String(k).padStart(2,"0")}-01`);let n=g.getFullYear(),o=g.getMonth()+1;return(i=l<n||l===n&&m<=o)&&(d=`${l}-${String(m).padStart(2,"0")}-01`),{success:!0,data:{hasPrevious:h,hasNext:i,previousDate:c,nextDate:d},errMsg:"",statusCode:200}}catch(a){return console.error("Data availability check error:",a),{success:!1,data:null,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}}},214829,a=>{"use strict";a.s(["checkAdStatsDataAvailabilityAction",()=>l,"checkDataAvailability",()=>g,"getAdStatsDataAction",()=>k,"getAdTotals",()=>j,"getTargetAdStatsData",()=>f]);var b=a.i(137936),c=a.i(887199),d=a.i(559330),e=a.i(713095);async function f(a,b,c){try{let e,f;if(!a||a<=0)return{success:!1,data:null,errMsg:"Invalid advertisement ID.",statusCode:400};if(!["7days","monthly"].includes(b))return{success:!1,data:null,errMsg:"Invalid period type.",statusCode:400};let g=(a=>{if(a){let[b,c,d]=a.split("-").map(Number);if(isNaN(b)||isNaN(c)||isNaN(d))throw Error(`Invalid date format: ${a}`);return new Date(b,c-1,d)}{let a=new Date;return new Date(a.getFullYear(),a.getMonth(),a.getDate())}})(c);if("7days"===b)(f=new Date(g)).setHours(23,59,59,999),(e=new Date(g)).setDate(g.getDate()-6),e.setHours(0,0,0,0);else{let a=g.getFullYear(),b=g.getMonth();e=new Date(a,b,1,0,0,0,0),f=new Date(a,b+1,0,23,59,59,999)}let h=(await d.default.adStats.findMany({where:{advertisementId:a,date:{gte:e,lte:f}},select:{date:!0,impressions:!0,clicks:!0,spentPoints:!0},orderBy:{date:"asc"}})).map(a=>({date:a.date.getFullYear()+"-"+String(a.date.getMonth()+1).padStart(2,"0")+"-"+String(a.date.getDate()).padStart(2,"0"),impressions:a.impressions,clicks:a.clicks,spentPoints:Number(a.spentPoints)})),i=h.reduce((a,b)=>a+b.impressions,0),j=h.reduce((a,b)=>a+b.clicks,0),k=h.reduce((a,b)=>a+b.spentPoints,0);return{success:!0,data:{stats:h,summary:{totalImpressions:i,totalClicks:j,totalSpentPoints:k,ctr:Math.round(100*(i>0?j/i*100:0))/100,cpc:Math.round(100*(j>0?k/j:0))/100},period:{type:b,startDate:e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0"),endDate:f.getFullYear()+"-"+String(f.getMonth()+1).padStart(2,"0")+"-"+String(f.getDate()).padStart(2,"0")}},errMsg:"",statusCode:200}}catch(a){return console.error("AdStats fetch error:",a),{success:!1,data:null,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}}async function g(a,b,c){try{let d,e;if(!a||a<=0)return{success:!1,data:null,errMsg:"Invalid advertisement ID.",statusCode:400};if(!["7days","monthly"].includes(b))return{success:!1,data:null,errMsg:"Invalid period type.",statusCode:400};let[f,g,h]=c.split("-").map(Number),i=new Date(f,g-1,h),j=new Date,k=new Date(2025,8,1),l=!1,m=!1;if("7days"===b){(d=new Date(i)).setDate(i.getDate()-7),(e=new Date(i)).setDate(i.getDate()+7);let a=new Date(d);a.setDate(d.getDate()+6),l=a>=k,m=e<=j}else{let a=1===g?f-1:f,b=1===g?12:g-1;d=new Date(a,b-1,1);let c=12===g?f+1:f,h=12===g?1:g+1;e=new Date(c,h-1,1),l=a>2025||2025===a&&b>=8;let i=j.getFullYear(),k=j.getMonth()+1;m=c<i||c===i&&h<=k}return{success:!0,data:{hasPrevious:l,hasNext:m,previousDate:l?d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0"):void 0,nextDate:m?e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0"):void 0},errMsg:"",statusCode:200}}catch(a){return console.error("Data availability check error:",a),{success:!1,data:null,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}}async function h(a){try{if(!a||a<=0)return{success:!1,data:null,errMsg:"Invalid advertisement ID.",statusCode:400};let b=await d.default.adStats.aggregate({where:{advertisementId:a},_min:{date:!0},_max:{date:!0}});if(!b._min.date||!b._max.date)return{success:!0,data:null,errMsg:"No statistics data available for this advertisement.",statusCode:200};return{success:!0,data:{earliestDate:b._min.date.toISOString().split("T")[0],latestDate:b._max.date.toISOString().split("T")[0]},errMsg:"",statusCode:200}}catch(a){return console.error("Date range fetch error:",a),{success:!1,data:null,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}}async function i(a,b,c,e){try{let f,g;if(!a||a<=0)return{success:!1,data:null,errMsg:"Invalid advertisement ID.",statusCode:400};if(!["daily","monthly"].includes(b))return{success:!1,data:null,errMsg:"Invalid aggregation type.",statusCode:400};if(c&&e)(f=new Date(c)).setHours(0,0,0,0),(g=new Date(e)).setHours(23,59,59,999);else{let a=new Date;(g=new Date(a)).setHours(23,59,59,999),f=new Date(a),"daily"===b?f.setDate(a.getDate()-29):f.setMonth(a.getMonth()-11),f.setHours(0,0,0,0)}let h=await d.default.adStats.findMany({where:{advertisementId:a,date:{gte:f,lte:g}},select:{date:!0,impressions:!0,clicks:!0,spentPoints:!0},orderBy:{date:"asc"}}),i=new Map;h.forEach(a=>{let c;if("daily"===b)c=a.date.toISOString().split("T")[0];else{let b=a.date.getFullYear(),d=(a.date.getMonth()+1).toString().padStart(2,"0");c=`${b}-${d}`}let d=i.get(c)||{impressions:0,clicks:0,spentPoints:0};i.set(c,{impressions:d.impressions+a.impressions,clicks:d.clicks+a.clicks,spentPoints:d.spentPoints+Number(a.spentPoints)})});let j=Array.from(i.entries()).map(([a,b])=>{let c=b.impressions>0?b.clicks/b.impressions*100:0,d=b.clicks>0?b.spentPoints/b.clicks:0;return{period:a,impressions:b.impressions,clicks:b.clicks,spentPoints:b.spentPoints,ctr:Math.round(100*c)/100,cpc:Math.round(100*d)/100}}).sort((a,b)=>a.period.localeCompare(b.period));return{success:!0,data:{stats:j,aggregationType:b,totalPeriods:j.length},errMsg:"",statusCode:200}}catch(a){return console.error("Aggregated stats fetch error:",a),{success:!1,data:null,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}}async function j(a){try{if(!a||a<=0)return{success:!1,data:null,errMsg:"Invalid advertisement ID.",statusCode:400};let[b,c]=await d.default.$transaction([d.default.adStats.aggregate({where:{advertisementId:a},_sum:{impressions:!0,clicks:!0}}),d.default.advertisement.findUnique({where:{id:a},select:{remainingBudget:!0}})]),e=b._sum.impressions||0,f=b._sum.clicks||0,g=c?.remainingBudget.toNumber()||0;return{success:!0,data:{totalImpressions:e,totalClicks:f,remainingBudget_number:g},errMsg:"",statusCode:200}}catch(a){return console.error("getAdTotals error:",a),{success:!1,data:null,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}}let k=async({userId:a,startDate:b})=>{try{return await (0,c.getAdStatsData)({userId:a,startDate:b})}catch(a){return{success:!1,data:null,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}},l=async({userId:a,currentDate:b})=>{try{return await (0,c.checkAdStatsDataAvailability)({userId:a,currentDate:b})}catch(a){return{success:!1,data:null,errMsg:a instanceof Error?a.message:"Internal Server Error.",statusCode:500}}};(0,e.ensureServerEntryExports)([f,g,h,i,j,k,l]),(0,b.registerServerReference)(f,"70b674f6cc2488a8a64a1651082fb11ff3dad06e85",null),(0,b.registerServerReference)(g,"7025103007b3362b2d4890c860dc5eff4546a1f0f8",null),(0,b.registerServerReference)(h,"400a1b964bbb2c3837700405733854244e7d642108",null),(0,b.registerServerReference)(i,"78b3aeb48512e30b78513acebd8b9c6731d923f76b",null),(0,b.registerServerReference)(j,"40668f4a26cc8980e7b5c37d9e9021085f8efd5f64",null),(0,b.registerServerReference)(k,"7fe6486bc5394c750ae068b6b3751741fa3a82d6e1",null),(0,b.registerServerReference)(l,"7fac57d494b662698499312e8ea99d2eb43ebff132",null)}];

//# sourceMappingURL=src_292cbcdb._.js.map